<div id="filters" class="clr-row">
  <h4 style="margin: 0.25rem 0.6rem;">Filters:</h4>

  <!-- map extent-->
  <span class="label lasting" [ngClass]="{'active':filterMapExtend, 'clickable':!filterMapExtend}"
    (click)="filterMapExtend=true; applyFilters('bbox');">
    map-extend
    <span *ngIf="bboxfilter && filterMapExtend" class="badge multi">{{this.datasetsFilteredLength}}</span>
    <span *ngIf="bboxfilter && filterMapExtend" class="badge clickable"
      (click)="filterMapExtend=false; applyFilters('bbox'); $event.stopPropagation();">x</span>
  </span>


  <!-- time extent -->
  <span *ngIf="!filterTimeRange" class="label lasting"
    [ngClass]="{'active':filterTimeRange, 'clickable':!filterTimeRange}"
    (click)="filterTimeRange=true; applyFilters('time');">
    time-range
  </span>
  <span *ngIf="filterTimeRange" class="label lasting"
    [ngClass]="{'active':filterTimeRange, 'clickable':!filterTimeRange}">
    <span>
      <ukis-date-range [(date-range)]="daterange" (change)="onDateChange($event)"></ukis-date-range>
    </span>
    <span class="badge clickable"
      (click)="filterTimeRange=false; applyFilters('time'); $event.stopPropagation();">x</span>
  </span>

  <!-- dynamic filters -->
  <span *ngFor="let filter of filtersFiltered; index as i">
    <span *ngIf="filter.selected" class="label">
      {{filter.selected.name}}
      <span class="badge clickable" (click)="filterRemove(i)">x</span>
    </span>
  </span>
</div>



<div id="dynamicfilters" class="clr-row">
  <div *ngFor="let filter of filtersFiltered; index as i" class="clr-col-sm">
    <h4>{{filter.title}}<span *ngIf="filter.selected"> - {{filter.selected.name}}</span></h4>

    <div class="clr-row">
      <span *ngFor="let n of filter.children" class="label" [ngClass]="{clickable:n.count,disabled:!n.count}"
        (click)="n.count?filterAdd(n,i):null">
        {{n.name}}
        <span *ngIf="n.count" class="badge">{{n.count}}</span>
      </span>
    </div>

  </div>
</div>




<clr-datagrid [(clrDgSelected)]="datasetSelected" (clrDgSelectedChange)="selectionChanged($event)"
  class="datagrid-compact">
  <clr-dg-placeholder>We couldn't find any datasets!</clr-dg-placeholder>

  <clr-dg-column *ngFor="let col of columns" [clrDgField]="col.bind?col.prop:undefined">
    <ng-container *clrDgHideableColumn="col">
      {{col.title}}
    </ng-container>
  </clr-dg-column>

  <clr-dg-row *clrDgItems="let d of datasetsFiltered" [clrDgItem]="d" [ngClass]="pick(d, tableProps.rowclass)">
    <clr-dg-cell *ngFor="let col of columns" [ngSwitch]="col.type">
      <a class="link" *ngSwitchCase="'link'" [attr.href]="pick(d, col.prop)" data-type="{{col.type}}">{{pick(d,
        col.prop)}}</a>
      <img class="image" *ngSwitchCase="'image'" [src]="imagesForDatatypes[pick(d, col.prop)] || ''">

      <div class="download" *ngSwitchCase="'download'">
        <a *ngIf="pick(d, col.prop.href) || pick(d, col.prop.status)" [attr.href]="pick(d, col.prop.href)"
          [attr.title]="pick(d, col.prop.title)" target="_blank" download>
          <clr-icon shape="download" [ngClass]="pick(d, col.prop.status)?'has-alert':false"></clr-icon>
        </a>
      </div>

      <div class="time" *ngSwitchCase="'date'">
        {{ convertToDate(pick(d, col.prop))}}
      </div>

      <span *ngSwitchDefault>{{pick(d, col.prop)}}</span>
    </clr-dg-cell>
    <clr-dg-row-detail *clrIfExpanded>
      <div [innerHTML]="pick(d, tableProps.rowdetail)" class="preview"></div>
    </clr-dg-row-detail>
  </clr-dg-row>

  <clr-dg-footer>
    <clr-dg-pagination #pagination [clrDgPageSize]="10">
      {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} datasets
    </clr-dg-pagination>
  </clr-dg-footer>
</clr-datagrid>